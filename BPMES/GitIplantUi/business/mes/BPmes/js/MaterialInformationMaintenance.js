/* 启动时加载 *//* */(function() {	function materialMaintenance() {		initGridData = function() {			var dgrid = dataGrid.datagrid('options');			if(!dgrid) return;			/*物料类型下拉框*/			dataPi=[],dataSer=[{'value':'','text':'全部 '}];    		var pi = {                url: "/iPlant_ajax",                dataType: "JSON",                data: {                    IFS: "MB00038"                },                successCallBack: function(a) {                	var op = a.RESPONSE[0].RESPONSE_DATA;                    $.each(op,function(n,obj) {                    	dataPi.push({'value':obj.DICT_IT,'text':obj.DICT_IT_NM});                    	dataSer.push({'value':obj.DICT_IT,'text':obj.DICT_IT_NM});				    });                      $("#searchITEM_TYPE").combobox("loadData", dataSer);                    $("#searchITEM_TYPE").combobox('select', dataSer[0].value);                },                errorCallBack: function() {                    $.messager.alert("提示","请联系管理员，查询失败！");                }            };    		/*工厂名称下拉框*/    		var Factory = {                    url: "/iPlant_ajax",                    dataType: "JSON",                    data: {IFS: "B000021"},                    successCallBack: function(a) {                    	var op = a.RESPONSE[0].RESPONSE_DATA;                        $.each(op,function(n,obj) {                        	dataFactory.push({'value':obj.FT_CD,'text':obj.FT_NM});    				    });                      },                    errorCallBack: function() {                        $.messager.alert("提示", '请联系管理员，查询失败！')                    }                };    		/*单位下拉框*/    		var Unit = {                    url: "/iPlant_ajax",                    dataType: "JSON",                    data: {IFS: "MB00040"},                    successCallBack: function(a) {                    	var op = a.RESPONSE[0].RESPONSE_DATA;                        $.each(op,function(n,obj) {                        	dataUnit.push({'value':obj.DICT_IT,'text':obj.DICT_IT_NM});    				    });                      },                    errorCallBack: function() {                        $.messager.alert("提示", '请联系管理员，查询失败！')                    }                };    		iplantAjaxRequest(Unit);    		iplantAjaxRequest(Factory);    		iplantAjaxRequest(pi);			searchDataGrid(dgrid);		},		bindGridData = function(reqData, jsonData) {			var gridList = {				name: 'InformationMaintenance_tab',				dataType: 'json',				columns: [[				    {field: 'FCT_CD',title: '工厂名称',width: 100,align: 'center',formatter: function (value,row) {if(checkNotEmpty(value)) return "<span title='" +  value + "'>" +  (row.FCT_NM || value)+ "</span>";},				    	 	editor:{type:'combobox',id:"status",options:{valueField:'value',textField:'text',data:dataFactory,required:true,editable:false}}},			        {field: 'BAR_CODE',title: '物料条形码',width: 150,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'validatebox',			        	   options:{required:true, validType:['length[1,50]','specialTextCharacter']}}},					{field: 'ITEM_CD',title: '物料编码',width: 150,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},			        	   editor:{type:'validatebox',options:{required:true, validType:['length[1,50]','specialTextCharacter'],			        	   }}},			        {field: 'ITEM_NM',title: '物料名称',width: 200,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'validatebox',			        	   options:{required:true, validType:['length[1,30]','specialCharacterTextArea']}}},				    {field: 'ITEM_TYPE',title: '物料类型',width: 80,align: 'center',formatter: function (value,row) {if(checkNotEmpty(value)) return "<span title='" +  value + "'>" +  (row.ITEM_TYPE_NM || value)+ "</span>";},						   editor:{type:'combobox',id:"status",options:{valueField:'value',textField:'text',data:dataPi,required:true,editable:false}}},					{field: 'ITEM_SIZE',title: '物料规格',width: 100,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'validatebox',						        options:{validType:['length[0,50]','specialTextCharacter']}}},					{field: 'UOM',title: '单位',width: 80,align: 'center',formatter: function (value,row) {if(checkNotEmpty(value)) return "<span title='" +  value + "'>" +  (row.UOM_NM || value)+ "</span>";},							   editor:{type:'combobox',id:"status",options:{valueField:'value',textField:'text',data:dataUnit,editable:false}}},					{field: 'MODEL_CD',title: '机型代码',width: 80,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'validatebox',						 options:{validType:['length[0,30]','specialTextCharacter']}}},					{field: 'MODEL_NM',title: '机型名称',width: 80,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'validatebox',			        	      options:{validType:['length[0,25]','specialTextCharacter']}}},  				    {field: 'PKG_UOM',title: 'Package单位',width: 100,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'validatebox',				           options:{validType:['length[0,20]','specialTextCharacter']}}},				    {field: 'WRK_TYPE',title: '作业类型',width: 80,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'validatebox',				           options:{validType:['length[1,20]','specialTextCharacter']}}},				    {field: 'CAPA',title: '每小时产能',width: 80,align: 'right',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'numberbox', options:{precision:0}}, 			            	   formatter:function(value,row,index){ return formatNumber(value,0); }}, 				    {field: 'ITEM_COLOR',title: '颜色',width: 60,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'validatebox',				           options:{validType:['length[0,25]','specialTextCharacter']}}},				    {field: 'VSN',title: '物料版本号',width: 80,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'validatebox',				           options:{validType:['length[0,25]','specialCharacterTextArea']}}},				    {field: 'CUST_CD',title: '客户编码',width: 80,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'validatebox',				           options:{validType:['length[0,25]','specialTextCharacter']}}},				    {field: 'CUST_NM',title: '客户名称',width: 80,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'validatebox',				           options:{validType:['length[0,25]','specialTextCharacter']}}},				    {field: 'PCS_IN_BOX',title: 'BOX装载PCS数量',width: 120,align: 'right',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'numberbox', options:{precision:0}}, 			            	   formatter:function(value,row,index){ return formatNumber(value,0); }}, 				    {field: 'BOX_IN_PLT',title: 'PALLET装载BOX数量',width: 150,align: 'right',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'numberbox', options:{precision:0}}, 				            	   formatter:function(value,row,index){ return formatNumber(value,0); }}, 				    {field: 'MAT_BAT_YN',title: '批次管理与否',width: 100,align: 'center',formatter: function(value, row, index) {if(value == 'Y') { return '是';} else { return '否';}},editor:{type:'checkbox',options:{on: 'Y',off: 'N'}}},				    {field: 'ITEM_VES',title: '批次版本号',width: 80,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'validatebox',				           options:{validType:['length[0,25]','specialCharacterTextArea']}}},					{field: 'WHS_CD',title: '仓库编码',width: 80,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'validatebox',					        options:{validType:['length[0,25]','specialTextCharacter']}}},					{field: 'WAREHOUSE_NAME',title: '仓库名称',width: 100,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";}},				    {field: 'USE_YN',title: '是否启用',width: 80,align: 'center',formatter: function(value, row, index) {if(value == 'Y') { return '是';} else { return '否';}},editor:{type:'checkbox',options:{on: 'Y',off: 'N'}}}, 			        {field: 'MO',title: '备注',width: 100,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'validatebox',				           options:{validType:['length[0,50]','specialTextCharacter']}}},			        {field: 'CRT_ID',title: '创建人',width: 80,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";}},					{field: 'CRT_DT',title: '创建时间',width: 180,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";}}, 					{field: 'UPT_ID',title: '修改人',width: 80,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";}}, 					{field: 'UPT_DT',title: '修改时间',width: 180,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";}}					]],				/**结束编辑模式的操作*/			     onEndEdit:function(index,row){			    	 var ed = $(this).datagrid('getEditor', {index: index,field: 'FCT_CD'});			    	 row.FCT_CD = $(ed.target).combobox('getValue');			    	 row.FCT_NM = $(ed.target).combobox('getText');			    	 var eddi = $(this).datagrid('getEditor', {index: index,field: 'ITEM_TYPE'});			    	 row.ITEM_TYPE = $(eddi.target).combobox('getValue');			    	 row.ITEM_TYPE_NM = $(eddi.target).combobox('getText');			    	 var edd2 = $(this).datagrid('getEditor', {index: index,field: 'UOM'});			    	 row.UOM = $(edd2.target).combobox('getValue');			    	 row.UOM_NM = $(edd2.target).combobox('getText');			     },			     /**进入编辑模式的操作*/			     onBeforeEdit:function(index,row){			    	 showmessage.html('');			    	 row.editing = true;			    	 row.edited = false;			    	 oldRow = JSON.stringify(row).replace(reg,'\"\"');			    	 $(this).datagrid('refreshRow', index);			     },			     /**编辑模式进入之后的操作*/			     onAfterEdit:function(index,row){			    	 /**判断是否进行数据变更*/			    	 var temp = JSON.stringify(row).replace(reg,'\"\"');			    	 if(temp!=oldRow){			    		 row.edited = true;			    	 }			    	 row.editing = false;			    	 $(this).datagrid('refreshRow', index);			     },		        onCancelEdit:function(index,row){		            row.editing = false;		            $(this).datagrid('refreshRow', index);		        },		        /**单击进入编辑模式*/		        onClickCell: function (index,field,value) {		        	var rows = dataGrid.datagrid('getRows'),row = rows[index];		        	if (editIndex != index){			    		var ed,fc,editorFt;			    		if(editIndex!=undefined){		    				/**判断是否为新增行，并验证新增工厂编码重复*/			    			rowEdit = dataGrid.datagrid('getRows')[editIndex];			    			if(checkNotEmpty(rowEdit.editType)){			    				if(rowEdit.editType=='add'){	    			    			}else{	    				        	   addDatagridEditor(dataGrid,index);	    			    			}			    				}else{			    					addDatagridEditor(dataGrid,index);			    					if(!checkNotEmpty(row.editType)){		/*如果是修改的情况，ft_cd字段为只读模式*/							    		ed = $(this).datagrid('getEditor', {index: index,field: 'ITEM_CD'});							    		fc = ed.target;							    		fc.prop('readonly',true);	    					    		ed2 = $(this).datagrid('getEditor', {index: index,field: 'BAR_CODE'});	    					    		fc2 = ed2.target;	    					    		fc2.prop('readonly',true);						    		}			    				}			    			}else{					    		 addDatagridEditor(dataGrid,index);					    		 if(!checkNotEmpty(row.editType)){							    		ed = $(this).datagrid('getEditor', {index: index,field: 'ITEM_CD'});							    		fc = ed.target;							    		fc.prop('readonly',true);	    					    		ed2 = $(this).datagrid('getEditor', {index: index,field: 'BAR_CODE'});	    					    		fc2 = ed2.target;	    					    		fc2.prop('readonly',true);						    		}			    			}			    		}else{			    			addDatagridEditor(dataGrid,index);			    			if(!checkNotEmpty(row.editType)){					    		ed = $(this).datagrid('getEditor', {index: index,field: 'ITEM_CD'});					    		fc = ed.target;					    		fc.prop('readonly',true);					    		ed2 = $(this).datagrid('getEditor', {index: index,field: 'BAR_CODE'});					    		fc2 = ed2.target;					    		fc2.prop('readonly',true);				    		}			    		}			    	}		        /**单击进入编辑模式*/			}			initGridView(reqData, gridList);			dataGrid.datagrid('loadData', jsonData);		},		searchDataGrid=function(dgrid){			var dgrid=$("#InformationMaintenance_tab").datagrid("options"),searchITEM_CD = $('#searchITEM_CD').textbox('getValue'),searchMODEL_NM = $('#searchMODEL_NM').textbox('getValue'),searchITEM_TYPE = $('#searchITEM_TYPE').textbox('getValue');			var reqData = {				IFS: 'MB00018',				ITEM_CD:searchITEM_CD,				ITEM_TYPE:searchITEM_TYPE,				MODEL_NM:searchMODEL_NM,				pageIndex: 1,				pageSize: dgrid.pageSize			};			reqGridData('/iPlant_ajax', 'InformationMaintenance_tab', reqData);		}		$("#ITEM_CD").blur(function(){			  alert("sss");		});		setDataNull=function(){			 $('#showFileName').html('');		},		OpenImprotFrame = function(){	 		$("#enditTabupload").dialog("open").dialog('setTitle', '物料信息导入');	 	};	 	importFile = function (){	    	   /* 以下即为完整客户端路径*/	    	   var pic = document.getElementById('txtPHOTO'),file,fileName,fileType,temp = [],strSrc;	    	   if(pic.files.length>0){	    		   file = pic.files[0],fileName = file.name,fileType=file.type;	    		   if(fileName.indexOf('.')>0){	    			   temp=fileName.split('.');	    			   strSrc = temp[temp.length-1];	    			   if(strSrc.toLowerCase().localeCompare('xlsx') === 0 || strSrc.toLowerCase().localeCompare('xls') === 0 ){	    				   $('#showFileName').html(fileName);	    			   }else{	    				   $('#showFileName').html('<font color=red>请输入excel文件！</font>');	    				   return false;	    			   }	    		   }	    	   }	       },		   ImportStation =function(){	    	   var webroot=document.location.origin;	    	   var pic = document.getElementById('txtPHOTO'),file,fileName,fileType,temp = [],strSrc;	    	   if(pic.files.length>0){	    		   file = pic.files[0],fileName = file.name,fileType=file.type;	    		   if(fileName.indexOf('.')>0){	    			   temp=fileName.split('.');	    			   strSrc = temp[temp.length-1];	    			   if(strSrc.toLowerCase().localeCompare('xlsx') === 0 || strSrc.toLowerCase().localeCompare('xls') === 0 ){	    				   $('#FILE_BELONG').val("ITEM_CD"),	    		    	   $('#FILE_CLS').val("import"),	    		    	   $('#FILE_TYPE').val('xlsx'),	    		    	   $('#importType').val('1'),	    		    	   $('#IFS').val('MB00019');	    				   var formData = new FormData($( "#importUplod" )[0]);  	    				   $.ajax({	    		                cache: true,	    		                type: "POST",	    		                url:webroot+'/iTaurus/iPlant_ImgUpload',	    		                data:formData,/*你的formid*/	    		                async: false,	    		                processData:false,	    		                contentType:false,	    		                error: function(request) {	    		                	$.messager.alert("提示", '导入失败！');	    		                	console.log(request);	    		                },	    		                success: function(data) {	    		                	$.messager.alert("提示", data[0].msg);	    		                }	    		            });	    			   }else{	    				   $('#showFileName').html('<font color=red>请输入excel文件！</font>');	    				   return false;	    			   }	    		   }	    	   }		   };	}	materialMaintenance.prototype = {		init: function() {			$(function() {				/*初始化全局变量对象*/				dataGrid = $('#InformationMaintenance_tab'),dataPi=[],dataFactory=[],dataUnit=[],showmessage=$('#showMessageInfo'),editIndex = undefined,oldRow=undefined, reg=new RegExp("null","g");				initGridData();				/*获取工厂类别下拉*/				$('#btnSearch').click(function() {										searchDataGrid();				});				$('#btnAdd').click(function() {							/*dataGrid.datagrid('acceptChanges');*/					var initData = {};					if(dataFactory.length>0){						initData={FCT_CD:dataFactory[0].value,ITEM_TYPE:dataPi[0].value,UOM:dataUnit[0].value,PCS_IN_BOX:0,BOX_IN_PLT:0,CAPA:0,WHS_CD:'C0001',USE_YN:"Y",MAT_BAT_YN:"Y"}					}					changeCheck="insert";					insertDataGrid('InformationMaintenance_tab',initData);				});								$('#btnDelete').click(function(){					var datadel = ['ITEM_CD','BAR_CODE'];					deleteDataGridMore('InformationMaintenance_tab',datadel,'MB00021','showMessageInfo');	            });				$('#btnSave').click(function() {					saveDataGrid('InformationMaintenance_tab','MB00019','MB00020','showMessageInfo');									});				/*导入*/				$('#btnImport').click(function() {					OpenImprotFrame();				});				/*导出*/				$('#btnExprt').click(function(){                	var now = new Date();                    var year =now.getFullYear();                	var reqData = {                			IFS:'MB00018'                	}                	createTable('tbIMESReport','物料信息导出','InformationMaintenance_tab',reqData);                });			});		}	}	var changeCheck="";var flag;	var fcfo = new materialMaintenance();	fcfo.init();})();