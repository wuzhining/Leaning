/* 启动时加载 *//* */(function() {	function materialMaintenance() {		initGridData = function() {//初始化加载			var dgrid = dataGrid.datagrid('options');//返回属性对象。			if(!dgrid) return;			var tmp = {                url: "/iPlant_ajax",                dataType: "JSON",                data: {IFS: "B000021"},//<!-- 查询工厂 -->                successCallBack: function(a) {                	dataTmp = [];                	var op = a.RESPONSE[0].RESPONSE_DATA;                    $.each(op,function(n,obj) {                    	dataTmp.push({'value':obj.FT_CD,'text':obj.FT_NM});				    });                  },                errorCallBack: function() {                    $.messager.alert("提示", '请联系管理员，查询失败！')                }            };			iplantAjaxRequest(tmp);/*发送请求*/			searchDataGrid(dgrid);		}				bindGridData = function(reqData, jsonData) {			var gridList = {				name: 'ProcessBom_tab',				dataType: 'json',				columns: [[					{field: 'FCT_CD',title: '工厂名称',width: 120,align: 'center',formatter: function (value,row) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + ( row.FCT_NM  || value)+ "</span>";},				           		   editor:{type:'combobox',options:{valueField:'value',textField:'text',data:dataTmp,required:true,editable:false}}},					{field: 'BOM_CD',title: '产品编码',width: 150,align: 'center',color: "blue",				           			  editor:{  				                            type:'combobox',				                            options:{				                            	required:true,				                            	valueField:'value',				                                textField:'text',				                                panelWidth:150,				                                panelHeight:150,				                                editable:false,				                                data:dataBOM2,				                                onSelect:function(data){														var target = $('#ProcessBom_tab').datagrid('getEditor', {'index':ccIndex,'field':'BOM_NM'}).target;													target.textbox('setValue', BOM[data.text]);																									}				                            }    				                        }				                      },				    {field:'BOM_NM', title: '产品名称', width:120,align:'center',editor:{type:'textbox',options:{editable:false}}},  					{field: 'ASMBLY_ITEM_CD',title: '所需装配物料',width: 150,align: 'center',formatter:function(){		        		   return "<img href='javascript:void(0)' class='easyui-linkbutton' src='../../../common/IplantCompent/themes/default/images/Folder.png'/>"}},			        {field: 'EFFECTIVE_DATE',title: '有效截至',width: 170,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'datebox',			        	   options:{validType:['length[1,50]','specialTextCharacter']}}},			        {field: 'USE_YN',title: '使用与否',width: 80,align: 'center',formatter: function(value, row, index) {if(value == 'Y') { return '是';} else { return '否';}},editor:{type:'checkbox',options:{on: 'Y',off: 'N'}}},					{field: 'MO',title: '备注',width: 100,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'validatebox',				           options:{validType:['length[0,50]','specialTextCharacter']}}},			        {field: 'CRT_ID',title: '创建人',width: 80,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";}},					{field: 'CRT_DT',title: '创建时间',width: 180,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";}}, 					{field: 'UPT_ID',title: '修改人',width: 80,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";}}, 					{field: 'UPT_DT',title: '修改时间',width: 180,align: 'center',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";}}					]],				/**结束编辑模式的操作*/			     onEndEdit:function(index,row){			    	 var ed = $(this).datagrid('getEditor', {index: index,field: 'FCT_CD'});			    	 row.FCT_CD = $(ed.target).combobox('getValue');			    	 row.FCT_NM = $(ed.target).combobox('getText');			     },			     /**进入编辑模式的操作*/			     onBeforeEdit:function(index,row){			    	 showmessage.html('');			    	 row.editing = true;			    	 row.edited = false;			    	 oldRow = JSON.stringify(row).replace(reg,'\"\"');			    	 $(this).datagrid('refreshRow', index);			     },			     /**编辑模式进入之后的操作*/			     onAfterEdit:function(index,row){			    	 /**判断是否进行数据变更*/			    	 var temp = JSON.stringify(row).replace(reg,'\"\"');			    	 if(temp!=oldRow){			    		 row.edited = true;			    	 }			    	 row.editing = false;			    	 $(this).datagrid('refreshRow', index);			     },		        onCancelEdit:function(index,row){		            row.editing = false;		            $(this).datagrid('refreshRow', index);		        },		        /**单击进入编辑模式*/		        onClickCell: function (index,field,value) {		        	ccIndex=index;		        	eeEndEdit('ProcessBom_tab');		        	var rowEdit,editem,editorFt,itemCd,dgrid;		        	var rows = dataGrid.datagrid('getRows'),row = rows[index];		        	/**判断是否为可编辑字段*/		        			        	if(field=='ASMBLY_ITEM_CD'){		        		endEditingAll(dataGrid);						titleName = '工序BOM设置',						dialogName = 'MaterialType_open',						tabName2 = 'materialMSD_tab',						$("#MSDtitle").html(row.PROD_CODE),						prodeC = row.PROD_CODE,						barcdru = row.BAR_CD_RULES,						bomNM = row.BOM_NM,						$("#search_PROD_CODE2").textbox('setValue',row.PROD_CODE),//产品代码						$("#search_ASMBLY_PROCS").textbox('setValue',row.ASMBLY_PROCS),//产品名称						//$("#ASSEMBLY_SEQUENCE_NUMBER").textbox('setValue',row.ASMBLY_SORT),//装配序列						dgrid = $('#ProcessBom_tab').datagrid('options'),						dgrid.itemCd = row.BOM_CD,						dgrid.fctCd = row.FCT_CD,						FCTCD = row.FCT_CD						EFFECTIVE_DATE = row.EFFECTIVE_DATE						reqDataXK = {									IFS: 'PX0000006',//工序BOM装配物料明细查询									BOM_CD:row.BOM_CD,									pageIndex: 1,									pageSize: dgrid.pageSize									};											openDialogFrame(tabName2,dialogName,titleName,reqDataXK);								        	}else{			        	if (editIndex != index){				    		if(editIndex!=undefined){			    				/**判断是否为新增行，并验证新增工厂编码重复*/				    			rowEdit = dataGrid.datagrid('getRows')[editIndex];				    			if(checkNotEmpty(rowEdit.editType)){				    				if(rowEdit.editType=='add'){				    											    			}else{							        	   addDatagridEditor(dataGrid,index);						    			}				    				}else{				    					addDatagridEditor(dataGrid,index);				    				}				    			}else{						    		 addDatagridEditor(dataGrid,index);				    			}				    		}else{				    			addDatagridEditor(dataGrid,index);				    		}				    	}		        			        },		        /**单击进入编辑模式*/			}			initGridView(reqData, gridList);			dataGrid.datagrid('loadData', jsonData);		},				/*产品编码下拉框传值*/		selectdataBOM = function(){			var Defer = $.Deferred();          //声明一个Defer对象			var BOM2 = {		            url: "/iPlant_ajax",		            dataType: "JSON",		            data: {IFS:'Z000053'},		            successCallBack: function(a) {		            	dataBOM2 = [];		            	var op = a.RESPONSE[0].RESPONSE_DATA;			                $.each(op,function(n,obj) {		                	dataBOM2.push({'text':obj.BOM_CD,'value':obj.BOM_CD});	                    	BOM[obj.BOM_CD]=obj.BOM_NM;					    }); 		              		                Defer.resolve();               //在Defer对象的resolve状态中把combobox对象传出去		            },		            errorCallBack: function() {		                $.messager.alert("提示", '请联系管理员，查询失败！')		            }		        };				iplantAjaxRequest(BOM2);				return Defer.promise();                                   //返回一个promise对象		}						/*产品编码或产品名称模糊查询接口*/		searchDataGrid=function(dgrid){			var search_PROD_CODE = $('#search_PROD_CODE').textbox('getValue');//产品编码或			var search_ASMBLY_PROCS = $('#search_ASMBLY_PROCS').textbox('getValue');//产品名称			var reqData = {				IFS: 'Z000025',//产品编码或产品名称模糊查询接口				BOM_CD:search_PROD_CODE,				BOM_NM:search_ASMBLY_PROCS,////产品名称				pageIndex: 1,				pageSize: dgrid.pageSize			}			reqGridData('/iPlant_ajax', 'ProcessBom_tab', reqData);		},		openDialogFrame =function(tabName,dialogName,titleName,reqData){					$("#"+dialogName).dialog("open").dialog('setTitle', titleName);			if(checkNotEmpty(reqData)){				dialogDataGrid('/iPlant_ajax', tabName, reqData);			}		},		dialogEditorDataGrid = function(tabName,reqData, jsonData) {			/*根据tabName判断哪个列表*/			var columnsTab,edDataGrid,messageInfo;			if(tabName=='materialMSD_tab'){				columnsTab=[						{field: 'FCT_CD',title: '工厂名称',hidden:true,width: 120,align: 'center',formatter: function (value,row) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + FCTCD+ "</span>";}},						{field: 'SEQ',title: '工序编号',hidden:true,width: 120,align: 'center',formatter: function (value,row) {							if(checkNotEmpty(value))return "<span title='" + value + "'>" + value+ "</span>";}},						{field: 'ASMBLY_ITEM_CD',title: '装配物料编号',hidden:true,width: 120,align: 'center',formatter: function (value,row) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value+ "</span>";}},						{field: 'PROD_CODE',title: '产品编号',hidden:true,width: 120,align: 'center',formatter: function (value,row) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value+ "</span>";}},						{field: 'ASMBLY_PROCS',title: '装配工序',width: 120,align: 'center',formatter: function (value,row) {							if(checkNotEmpty(value)){								return "<span title='" + value + "'>" + value+ "</span>";							}							}},						{field:'BOM_NM', title: '物料名称', width:200,align:'center',editor:{type:'textbox',options:{editable:false}}}, 	                    {field:'BOM_CD', title: '物料编码', width:200,align:'center',editor:{type:'textbox',options:{editable:false}}}, 	                    {field: 'T_ASMBLY_ITEM_details',title: '请选择物料详情',width: 150,align: 'center',formatter:function(){ 	                    	 return "<img href='javascript:void(0)' class='easyui-linkbutton' onclick='openReplaceDialogFrame()'  src='../../../common/IplantCompent/themes/default/images/Folder.png'/>"}},				        {field: 'ASMBLY_SORT',title: '装配顺序',width: 60,align: 'right',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'numberbox',					           options:{required:true, validType:['length[1,50]','specialCharacterTextArea']}}},				        {field: 'UNIT_QTY',title: '数量',width: 60,align: 'right',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'numberbox',					           options:{required:true, validType:['length[1,50]','specialCharacterTextArea']}}},		            	{field: 'VERSION',title: '工序物料版本号',width: 100,align: 'right',formatter: function (value) {if(checkNotEmpty(value)) return "<span title='" + value + "'>" + value + "</span>";},editor:{type:'numberbox',					           options:{required:true, validType:['length[1,50]','specialCharacterTextArea']}}},			        	];				edDataGrid = $('#'+tabName);				messageInfo = $('#showMSDInfo');			}						var gridList = {				name: tabName,//表名				dataType: 'json',//数据类型				pagination:false,//如果为true，则在DataGrid控件底部显示分页工具栏。				fitColumns:true,//真正的自动展开/收缩列的大小，以适应网格的宽度，防止水平滚动。				rownumbers:true,//如果为true，则显示一个行号列。				loadMsg: '数据加载中...',//在从远程站点加载数据的时候显示提示消息。				columns: [columnsTab],//DataGrid列配置对象						        /**单击进入编辑模式*/			     onClickRow: function (index, row) {			    	 ccIndex=index;                	 eeEndEdit('materialMSD_tab');                	 $('#materialMSD_tab').datagrid('selectRow', index).datagrid('beginEdit', index);                	 var BOM_CD = $("#MSDtitle").html();                	 var itemCODE = row.ASMBLY_ITEM_CD;                	 assignmentOrSave(BOM_CD,itemCODE);	            },			}			initGridView(reqData, gridList);			$('#'+tabName).datagrid('loadData', jsonData);		}	}			/*给弹框左侧区域赋值或输入值保存*/	 assignmentOrSave = function(BOM_CD,ASMBLY_ITEM_CD){		 var reqDate = {                 url: '/iPlant_ajax',                 dataType: 'JSON',                 data: {                	 BOM_CD: BOM_CD,                	 ASMBLY_ITEM_CD: ASMBLY_ITEM_CD,                     IFS: 'PX0000006'//工序BOM装配物料明细查询                 },                 successCallBack: function (data) {                	/* 如果有值，把值加载到左侧区域*/                	 if(data.RESPONSE[0].RESPONSE_DATA.length > 0){                		 /*禁用左侧区域输入框*/                		 $('input[name = items]').prop('disabled',true);                		 /*隐藏域赋值*/                		 if(data.RESPONSE[0].RESPONSE_DATA[0].TRACE_WAY == '单个追溯'){                			 $('input[name = items]').prop('checked',false);                			 $('input[name = items2]').prop('checked',false);                			 $('#MonomerRetrospect').prop('checked',true);                			 $('#MonomerRetrospect2').prop('checked',true);                		 }else if(data.RESPONSE[0].RESPONSE_DATA[0].TRACE_WAY == '物料编码'){                			 $('input[name = items]').prop('checked',false);                			 $('input[name = items2]').prop('checked',false);                			 $('#MaterialNum').prop('checked',true);                			 $('#MaterialNum2').prop('checked',true);                		 }else if(data.RESPONSE[0].RESPONSE_DATA[0].TRACE_WAY == '批次追溯'){                			 $('input[name = items]').prop('checked',false);                			 $('input[name = items2]').prop('checked',false);                			 $('#BatchRetrospect').prop('checked',true);                			 $('#BatchRetrospect2').prop('checked',true);                		 }                	 }else{                		 var ASMBLY_PROCS =$('#search_ASMBLY_PROCS').textbox('getValue');//产品名称                		 var item = $('#check input[name=items]:checked').val();                	 }                     return;                 },                 errorCallBack: function (data) {                 	showmessage.html('<font color=red>查询失败！</font>');                     return;                 }             };               iplantAjaxRequest(reqDate);	 } 	 //判断编辑表格中增加的数据是否重复 materialMSD_tab	 reaptitionbytableoninsert = function(){		 var rows=$('#materialMSD_tab').datagrid("getRows");		 var flag=false;				 if(rows.length>1){			 for (var i = 0; i < rows.length-1; i++) {				 for (var j = i+1; j <= rows.length-1; j++) {					 if(rows[i].SEQ==rows[j].SEQ && rows[i].BOM_CD==rows[j].BOM_CD && rows[i].VERSION==rows[j].VERSION){						 console.log(rows[i].SEQ+"-- "+rows[j].SEQ+"-- "+rows[i].BOM_CD+"--"+rows[j].BOM_CD+"--"+rows[i].VERSION+"--"+rows[j].VERSION+"进来了");						 $('#showMSDInfo').html('<font color=red>数据已重复，请查证！</font>');						 flag=true;						 break;					 }else{						 if(rows[i].SEQ==rows[j].SEQ&& rows[i].VERSION==rows[j].VERSION ){//工序相同的情况下才进行顺序筛查							 if(rows[i].ASMBLY_SORT==rows[j].ASMBLY_SORT){								 console.log(rows[i].ASMBLY_SORT+"顺序"+rows[j].ASMBLY_SORT)								 flag=true;								 console.log(flag);								 $('#showMSDInfo').html('<font color=red>装配顺序已重复，请查证！</font>');								 break;							 }						 }					 }									}				 if(flag)break;			}		 }		 		 return flag;	 }	 	 	 saveDataGridAssembly = function(){		 var TRACE_WAY1 = $('#check input[name=items]:checked').val();		 var edDataGrid = $('#materialMSD_tab');         if (endEditing(edDataGrid)){//结束编辑行        	/*判断后变更数据*/        	if (edDataGrid.datagrid('getChanges').length) {//从上一次的提交获取改变的所有行。类型参数指明用哪些类型改变的行，可以使用的值有：inserted,deleted,updated等。当类型参数未配置的时候返回所有改变的行。                var inserted = edDataGrid.datagrid('getChanges', "inserted");                   updated =  edDataGrid.datagrid('getChanges', "updated");                /**装载数据*/                var arrInsert = new Array(),arrUpdate = new Array();            	                //增加                if(inserted.length>0){                	for(var m=0;m<inserted.length;m++){                		arrInsert.push(inserted[m]);//增加每一列字段                	}                	for (var i = 0; i < arrInsert.length; i++) {                		arrInsert[i].SEQ = prf_cd;                		arrInsert[i].TRACE_WAY = TRACE_WAY1;                		arrInsert[i].EFFECTIVE_DATE = EFFECTIVE_DATE;//有效期                		arrInsert[i].PROD_CODE = prodeC;                		arrInsert[i].ASMBLY_ITEM_CD= arrInsert[i].BOM_CD;					}                	                	var flag=reaptitionbytableoninsert();                                	if(!flag){                	/*批量先增*/                	var ajaxInsert = {                            url: '/iPlant_ajax',                            dataType: 'JSON',                            data: {                                list: arrInsert,                                IFS: 'PX0000005'                            },                            successCallBack: function (data) {                            	                            	edDataGrid.datagrid('acceptChanges');//提交所有从加载或者上一次调用acceptChanges函数后更改的数据。                            	$('#showMSDInfo').html('<font color=red>保存成功！</font>');                                return;                            },                            errorCallBack: function (data) {                            	$('#showMSDInfo').html('<font color=red>保存失败！</font>');                                return;                            }                    };                    iplantAjaxRequest(ajaxInsert);                                    	}else{                		return;                	}                }                //修改                if(updated.length>0){                	for(var m=0;m<updated.length;m++){                		arrUpdate.push(updated[m]);                	}                	var flag=reaptitionbytableoninsert();                                	if(!flag){                	//批量修改                    var ajaxUpdate = {                        url: '/iPlant_ajax',                        dataType: 'JSON',                        data: {                            list: arrUpdate,                            IFS: 'PX0000007'                        },                        successCallBack: function (data) {                        	edDataGrid.datagrid('acceptChanges');                        	$('#showMSDInfo').html('<font color=red>保存成功！</font>');                            return;                        },                        errorCallBack: function (data) {                        	$('#showMSDInfo').html('<font color=red>保存失败！</font>');                            return;                        }                    };                    iplantAjaxRequest(ajaxUpdate);                	}else{return;}                }        	            }else{            	$('#showMSDInfo').html('<font color=red>没有进行变更！</font>');            }		}else{			$('#showMSDInfo').html('<font color=red>请输入必填项！</font>');		}	 }	 	 	 saveDept = function(){		 saveDataGridAssembly();		 openDialogFrame(tabName2,dialogName,titleName,reqDataXK);	 }	 	        /*编辑字段*/	eeEndEdit = function(str){		var rows = $('#'+str).datagrid('getRows');		if(rows.length>0){			for(var i=0; i<rows.length; i++){				$('#'+str).datagrid('endEdit',i);			}		}	},	setDataNull = function () { 		$('#search_PROD_CODE2').setValue('');          }					/**根据条件查询物料信息**/		 getMaterialDataBySearch = function(){			var tabName = 'materialDetails_tab';//da得到要操作的表名 materialDetails_tab			var dgrid = $('#'+tabName).datagrid('options');//创建多选框			if(!dgrid) return;//如果不存在就返回			var bomcd = $('#materialCode').textbox('getValue');			var bomname = $('#materialName').textbox('getValue');						 reqData1 = {				BOM_CD:bomcd,				BOM_NM:bomname,				IFS: 'PX0000004',				pageIndex: dgrid.pageNumber,				pageSize: dgrid.pageSize			}			dialogDataGrid1('/iPlant_ajax', tabName, reqData1);								   /*查询物料详情列表数据*/		   dialogEditorDataGrid1 = function(reqData1, jsonData){			var gridLists1 = {				name :'materialDetails_tab' ,				dataType : 'json',				singleSelect: false,				columns : [[					{field:'BOM_CD',title:'物料编码',width:180,align:'center',formatter:function(value,row) {if (value != null) return "<span title='" + value+ "'>" + value + "</span>";}},					{field:'BOM_NM',title:'物料名称',width:180,align:'center',formatter:function(value) {if (value != null) return "<span title='" + value+ "'>" + value + "</span>";}},				 ]],				 onDblClickRow: function(index,row){					 addReplaceMaterialConfirm();		         }			}				initEditorDataGridView1(reqData1, gridLists1);			$('#materialDetails_tab').datagrid('loadData', jsonData);					}	 }					/* 添加工序选择窗口弹出框	 */		addProcessNO=function(){			$("#VendorCodeDetails").dialog("open").dialog('setTitle','工序名称');			$('#showMaster').html('');		}				 				/**查询工序信息**/		getVendorCodeBySearch = function(){			var tabName = 'VendorCodeDetails_tab';//要显示工序名称的表名			var dgridOp = $('#'+tabName).datagrid('options');//添加下拉选项			if(!dgridOp) return;//如果不存在就返回			var code = $('#searchVendorCode').val();			var reqDataA = {				IFS: 'PX0000003',				pageIndex: 1,				pageSize: dgridOp.pageSize			}			dialogDataGrid1('/iPlant_ajax', tabName, reqDataA);//加载请求表名，虚拟路径，请求参数			dialogEditorDataGrid1 = function(reqDataA, jsonData) {//加载返回参数，jsonData是返回数据结果集				var gridLists2 = {						name :tabName,						dataType : 'json',						columns : [[						      {field:'ROUTE_CD',title: '工序编码',width: 130,align: 'center',formatter: function (value,row) {if (value != null) return "<span title='" + value + "'>" + value + "</span>";}},						      {field:'ROUTE_NAME',title: '工序名称',width: 130,align: 'center',formatter: function (value) {if (value != null) return "<span title='" + value + "'>" + value + "</span>";}},						 ]],						 onDblClickRow: function(index,row){							 selectVendorCode(row.ROUTE_CD,row.ROUTE_NAME);							 prf_cd=row.ROUTE_CD;				         }					}				initEditorDataGridView1(reqDataA, gridLists2);				$('#'+tabName).datagrid('loadData', jsonData);//加载返回数据				var VendorCode = $('#processNM').textbox('getValue');		 				}		}						/**根据产品编码查询工序BOM明细是否存在**/		queryProcessBOMByProcedNo = function(){			row = $('#ProcessBom_tab').datagrid('getSelected');			 var reslut=false;			 if(row){				 iplantAjaxRequest({					 url: '/iPlant_ajax',					 dataType: 'JSON',					 async: false, 					 data: {						 IFS: 'PX0000006',						 BOM_CD:row.PROD_CODE,					 },					 successCallBack: function (data) {						 var re=data.RESPONSE[0].RESPONSE_DATA;						 if(re.length>0){							 reslut= true;						 }						 					 }				 });			 }			return reslut;					}						//判断编辑表格中修改的数据是否重复 ProcessBom_tab		 reaptitionbytable = function(){			 endEditing($('#ProcessBom_tab'));//结束编辑行			 var rows=$('#ProcessBom_tab').datagrid("getRows");			 var flag=false;			 if(rows.length>0){				 for (var i = 0; i < rows.length-1; i++) {					 for (var j = i+1; j <= rows.length-1; j++) {						 if(rows[i].BOM_CD==rows[j].BOM_CD ){							 console.log(rows[i].BOM_CD+"进来了"+rows[j].BOM_CD);							 flag=true;							 break;						 }											}					 if(flag)break;				}			 }			 return flag;		 }				/*选择工序并赋值*/		selectVendorCode=function(item_cd,item_nm){	    	  $('#processNM').textbox('setValue',item_nm);	    	  $('#processNO').textbox('setValue',item_cd);	    	  $("#VendorCodeDetails").dialog("close");		}										materialMaintenance.prototype = {		init: function() {			$(function() {				/*初始化全局变量对象*/				dataGrid = $('#ProcessBom_tab'),dataCompany=[],dataFactory=[],dataTmp=[],dataBOM=[],showmessage=$('#showMessageInfo'),editIndex = undefined,oldRow=undefined, reg=new RegExp("null","g");				selectdataBOM().then(function(){initGridData()});				initGridData();				/*获取工厂类别下拉*/				$('#btnSearch2').click(function() {						searchDataGrid(dataGrid);				});								$('#btnAdd').click(function() {							ccIndex= 0;					count=1;					var editData = $('#ProcessBom_tab').datagrid('getChanges', "inserted");					if(editData.length == 0){						var initData = {};						if(dataTmp.length>0 && dataBOM2.length>0){							initData={FCT_CD:dataTmp[0].value,ITEM_CD:dataBOM2[0].value,USE_YN:'1',IF_SIDE:'N'}						}						insertDataGrid('ProcessBom_tab',initData);										}else{						$.messager.show({			         	    title:'提示',			         	    msg:'请先维护完上一条新增数据之后再继续添加新的数据。',			         	    showType:'slide',			         	    showSpeed:'8600',			         	    style:{			         	    	left:document.body.clientWidth-250, // 与左边界的距离			         	    	top:document.body.clientHeight-100 // 与顶部的距离			         	    }			         	});					}					endEditing($('#ProcessBom_tab'));//结束编辑行					dataBOM3=editData;				});								$('#btnDelete').click(function(){					var reslut=queryProcessBOMByProcedNo();					if(reslut){						deleteDataGridXK('ProcessBom_tab','PROD_CODE','PX00000011','showMessageInfo');					}else{						deleteDataGrid('ProcessBom_tab','BOM_CD','PX0000009','showMessageInfo');					}	            });				$('#btnSave').click(function() {					if(count==1){//增加					var flag=reaptitionbytable();						if(flag){							$.messager.show({				         	    title:'提示',				         	    msg:'数据已经存在！请重新选择~',				         	    showType:'slide',				         	    showSpeed:'8600',				         	    style:{				         	    	left:document.body.clientWidth-250, // 与左边界的距离				         	    	top:document.body.clientHeight-100 // 与顶部的距离				         	    }				         	});												}else{							saveDataGrid('ProcessBom_tab','Z000026','PX0000010','showMessageInfo');						}					}else{//修改						var reslut=queryProcessBOMByProcedNo();						if(reslut){//判断子表是否存在							$.messager.show({								title:'提示',								msg:'该工序BOM存在BOM清单，如要修改，请先删除BOM清单',								showType:'slide',								showSpeed:'8600',								style:{									left:document.body.clientWidth-250, // 与左边界的距离									top:document.body.clientHeight-100 // 与顶部的距离								}							});													}else{							var flag=reaptitionbytable();							if(flag){								$.messager.show({					         	    title:'提示',					         	    msg:'数据已经存在！请重新选择~',					         	    showType:'slide',					         	    showSpeed:'8600',					         	    style:{					         	    	left:document.body.clientWidth-250, // 与左边界的距离					         	    	top:document.body.clientHeight-100 // 与顶部的距离					         	    }					         	});														}else{								saveDataGrid('ProcessBom_tab','Z000026','PX0000010','showMessageInfo');							}						}					}					initGridData();				});				$('.close').click(function() {					$('#MaterialType_open').dialog('close');				});							/* 打开物料信息弹出框	 */				openReplaceDialogFrame=function() {					$('#showMaterial').html('');					$("#addMaterialDetails").dialog("open").dialog('setTitle', '物料信息详情');					getMaterialDataBySearch();				}										 /**物料选择框中确定*/				 addReplaceMaterialConfirm=function(){					 //得到table的选中行					var row = $("#materialDetails_tab").datagrid("getSelected");					if (row) {						$("#addMaterialDetails").dialog("close");						var row2 = $("#materialMSD_tab").datagrid("getSelected");						if(row2){							var rowInex=$("#materialMSD_tab").datagrid("getRowIndex",row2);							var ed = $('#materialMSD_tab').datagrid('getEditor', {index:rowInex,field:'BOM_CD'});							$(ed.target).textbox('setValue', row.BOM_CD);							BOM_CD=$(ed.target).textbox('getValue');							var ed2 = $('#materialMSD_tab').datagrid('getEditor', {index:rowInex,field:'BOM_NM'});							$(ed2.target).textbox('setValue', row.BOM_NM);						}else{							$.messager.alert('提示', '请选择一条数据进行编辑');						}					}				}			    /*选择物料详情并赋值*/		      assignment=function(item_cd,item_nm){		    			    	  $('#materialCode').textbox('setValue',item_cd);		    	  $("#addMaterialDetails").dialog("close");				}		      				/**函数功能：新增、修改栈位物料保存*/				saveAddUpdateStackMaterial=function(){					//$("#addMaterialDetails").dialog("close");					$("#addMaterialDetails").dialog("close");				    $('#MaterialType_open').dialog('close');				}												/*弹框增删改*/				$('#btnMSDAdd').click(function() {						/*启用左侧区域输入框*/					$("#search_ASMBLY_PROCS").textbox({disabled:false});//工序名称					$('input[name = items]').prop('disabled',false);										ccIndex= 0;					eeEndEdit('materialMSD_tab');					var dgrid = $('#materialMSD_tab').datagrid('options');					var prodCode = $("#MSDtitle").html();						asmblyprocs = $('#processNM').textbox('getValue'); /*装配工序*/					SEQ2 = $('#processNO').textbox('getValue'); /*工序编号*/					traceway = $('#check input[name=items]:checked').val();  /*追溯方式*/					$('#materialMSD_tab').datagrid('insertRow',{index:0,row:{//自动从左侧填充到右侧的数据表格栏中						TRACE_WAY:traceway,						ASMBLY_PROCS:asmblyprocs,//自动填充						SEQ:SEQ2,//自动填充						FCT_CD:FCTCD,						BOM_NM:material_name,						USE_YN:'Y',					}});					$('#materialMSD_tab').datagrid('selectRow', 0).datagrid('beginEdit', 0); 				});											     								$('#btnMSDDelete').click(function(){					//多主键的时候删除					deleteDataGridMore('materialMSD_tab',['SEQ','BOM_CD'],'PX0000008','showMSDInfo');									});								$('#btnMSDSave').click(function() {					saveDataGridAssembly();									});																$('#btnImport').click(function() {	/*导入*/					$("#materialImportDialog").dialog("open").dialog('setTitle', '工序BOM导入');									});								$('#btnExprt2').click(function(){	/*导出*/					var now = new Date();					var year =now.getFullYear();					var reqData = {							IFS:'Z000025'//工序BOM装配物料明细查询					}					createTable('tbIMESReport','工序BOM导出','ProcessBom_tab',reqData);				});			});		}	}	var fcfo = new materialMaintenance(),dataBOM2 = [];dataBOM3="";var ccIndex= 0;/*全局索引;*/	var BOM = {},FCTCD,tabName2,prf_cd,updated,count,dialogName,titleName,EFFECTIVE_DATE,prodeC,reqData1,reqDataXK,barcdru,bomNM,ASMBLY_PROCS,SEQ2,asmblyprocs,BOM_CD,material_name,traceway	fcfo.init();})();